#!/bin/bash

# Start in docker/ always
if [[ $(basename `pwd`) != docker ]]
then
    cd docker/
fi

read -p "Build GPU-enabled image? [Y/n] " gpu
if [[ $gpu =~ ^[Yy]$ ]]
then
    compute_device=gpu
else
    compute_device=cpu
fi

docker build  -t gym-$compute_device --build-arg baseimage=ntaylor22/tensorflow-$compute_device .

if [ ! -f jupyter_notebook_config.json ]
then
    script="from notebook.auth import passwd; c = passwd(); open('/home/pass_hash','w').write(c)"
    docker run --rm -it -v $PWD:/home gym-$compute_device python3.6 -c "$script"
    echo "{\"NotebookApp\": {\"password\": \"`cat pass_hash`\"}}" > jupyter_notebook_config.json
fi
  
rm -f Dockerfile2 pass_hash
